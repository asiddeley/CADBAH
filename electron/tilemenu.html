
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">


<style>

.oldmsgbox{
	width:96px; height:96px;
	background-color:silver; 
	border-color:black;
	border-width:1px;
	color:black;
	overflow:auto;
	font-family:'roboto', sans-serif;
	font-size:0.75em;
}

.status-bar {height:16px;}
.message-board {height:192px;}
.status-bar, .message-board{
	background-color:rgb(11,62,111);
	padding:8px;
	color:white;
	overflow:auto;
	font-family:'roboto', sans-serif;
	font-size:0.75em;
}


.tile-group {
	background-color:black; 
	width:96px;
	height:112px;
}

.tile-group-text {
	background-color:silver;
	border-color:black;
	border-width:1px;
	padding:0px;
	margin:0px;
	color:black;
	fill:black;
	font-family:roboto, sans-serif; 
	font-size:0.75em;
	text-align:center;
}

.grid-container {
  display: grid;
  grid-template-columns: auto auto auto;
  grid-gap: 8px;
  background-color:rgb(11,62,111);
  padding: 8px;
}

.cad-msg {
	display:block;
	color:ren\d;
}

.cad-debug {
	display:block;
	color:gray;
}

</style>
<script type="text/javascript">

	const jQuery=require('jquery'); window.$=jQuery

	const CS=require('../electron/support.js')

	// messageboard
	var MB
	
	var onMessage=function(prop, action, newValue, oldValue){
		//console.log('xMessage received', newValue)
		if (newValue.debug){MB.debug(newValue.html)}
		if (newValue.wipe){MB.wipe()}
		else {MB.message(newValue.html)}
	}

	function statusClear(){$('.status-bar').text('')}
	
	function echo(command){
		$('.status-bar').text(command)
		setTimeout(statusClear, 1000)
	}

	var onSuccessText
	var onSuccess=function(response, action, newValue, oldValue){
		//console.log('onSuccess...', response, action, newValue, oldValue)
		//typical handler
		if (typeof onSuccessText=='function'){
			//onSuccessText()
		}
		else { MB.message(newValue.result) }
	}
	
	var onFailureText
	var onFailure=function(response){
		//console.log('onFailure...', response, action, newValue, oldValue)
		//typical handler
		if (typeof onFailureText=='function'){
			//onFailureText()
		}
		else { MB.debug(newValue) }
	}
	
	// remote or external interactions
	var REMOTE = require('electron').remote
	var WM=REMOTE.require('electron-window-manager')
	WM.sharedData.watch('xSuccess', onSuccess)
	WM.sharedData.watch('xFailure', onFailure)
	WM.sharedData.watch('xMessage', onMessage)

	// asynchronous checker
	var whenlimit=20
	var wheninterval=500
	var when=function(check, callback){
		whenlimit-=1
		// callback or keep on watching within limit
		if (check()){callback()}
		else if (whenlimit>0){setTimeout(function(){when(check, callback)}, wheninterval)}		
	}
	
	$(document).ready(function(){

		MB=new CS.MessageBoard({
			el:$('.message-board'),
			cssMessage:'cad-msg',
			cssDebug:'cad-debug'		
		})
	
		// load external tile-groups
		var loaded=0
		var loadables=$('.tile-group[src]').length
		$('.tile-group').each(function(index){
			var xml=$(this).attr('src')
			if (xml){$(this).load(xml, ()=>loaded++)}			
		})

		var doneLoading=function(){return (loaded==loadables)}
		
		// program tiles when all external tile files are loaded
		when(doneLoading, function(){
			$('.tile')
			.on('mouseenter', function(){$(this).css('fill','gold')})
			.on('mouseleave', function(){$(this).css('fill','silver')})
			.on('mousedown', function(){$(this).css('fill','gray')})
			.on('mouseup', function(){$(this).css('fill','silver')})
			.on('click',function(){
				// find desc element and submit content to CAD as a command
				var command=$(this).find('.command').text()
				onSuccessText=$(this).find('.onSuccess').text()
				onFailureText=$(this).find('.onFailure').text()
				echo(command)
				WM.sharedData.set('xSubmit', {command:command,	date:new Date()})
			})
		})

	}) 

</script>


</head>

<body>

<div class='grid-container'>
	<div class='tile-group' src='tilemenu_lines.xml'></div>
	<div class='tile-group' src='tilemenu_empty.xml'></div>
	<div class='tile-group' src='tilemenu_empty.xml'></div>
	<div class='tile-group' src='tilemenu_empty.xml'></div>
	<div class='tile-group' src='tilemenu_empty.xml'></div>
	<div class='tile-group' src='tilemenu_empty.xml'></div>
	<div class='tile-group' src='tilemenu_empty.xml'></div>
	<div class='tile-group' src='tilemenu_empty.xml'></div>
	<div class='tile-group' src='tilemenu_empty.xml'></div>
</div>
<div class='tile-group-text'>STATUS BAR</div>
<div class='status-bar'>status</div>
<div class='tile-group-text'>MESSAGE BOARD</div>
<div class='message-board'>message board</div>


</body>
</html>