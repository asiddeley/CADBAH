
<!DOCTYPE html>
<html lang="en">
<head>
<title>CADbah</title>
<meta charset="utf-8">

<STYLE type="text/css">

#cad-view {
	display:block;
	height:400px;
	width:100%;
}


#cad-view > canvas {
	/* border: 1px solid #666; */
	width:100%;
	height:100%
}

.progress {
	opacity: 0;
	-webkit-transition: opacity 1s linear;
	-moz-transition: opacity 1s linear;
	-ms-transition: opacity 1s linear;
	-o-transition: opacity 1s linear;
	transition: opacity 1s linear;
}

.progress.loading {
	opacity: 1;
}	
	
#navbar {padding:0px; width:100%;}
	
	
</STYLE>

<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="jquery-ui.js"></script>
<link rel="stylesheet" type="text/css" href="jquery-ui.theme.css">
<link rel="stylesheet" type="text/css" href="jquery-ui.structure.css">
<script type="text/javascript" src="babylon.js"></script>
<script type="text/javascript" src="babylon.canvas2d.js"></script>

<script type="text/javascript" src="CADbah.dist.js"></script>

<script>

function initMenus(navbuttonIdStr, menuIdStr){
	var bids=navbuttonIdStr.split(" ");
	var mids=menuIdStr.split(" ");
	for (var i in bids){
		// Register following function triggered by each nav button
		// When executed, function positions menu at each navbutton location
		$('#'+bids[i]).mouseenter({bid:bids[i], mid:mids[i]}, function(ev){
			//note how data is passed using first argument of mouseenter
			var navbutton=ev.data.bid; 
			var menu=ev.data.mid;
			$('.menu').hide();
			// Show and position menu of interest at its navbutton
			$('#'+ menu).show().position({
				my:'left top',
				at:'left bottom',
				of:'#'+navbutton
			});
			// autohide in case menu is left hanging - don't forget to disarm if entered
			document.DDAH=setTimeout(function(){$('#'+menu).hide();}, 2000);
		});
	};
};

function inputHandler(ev){
	ev.preventDefault(); //disable normal form submit behavior that refreshes page
	var i=$("#myInput").val(); //get text from form 
	$("#myInput").val(''); //clear the form
	CAD.cmd(i); //pass command to CAD for processing
	return false; //prevent further bubbling of event
};


$(document).ready(function(){

var $cl=$("#myInput");

//Turn off the browser's right-click context menu
$(document).on('contextmenu', false);

//basic behavior
$(window).on({
	//prevent accidental drag-and-drop on windox
	"drop": function(e){ e=e||event; e.preventDefault(); return false;},
	"dragover":function(e){ e=e||event; e.preventDefault(); false;},
	//focus on command line (if not already) when keys pressed
	"keypress":function(e){ e=e||event;
		if(!$cl.is(":focus")){
			//$cl.focus(); //should work but not fully
			$cl.get(0).focus();
			$cl.get(0).select();
		};
	}
});


//setup Navbar using jquery-ui controlgroup widget
$("#navbar").controlgroup({items:{
	//widgetToApply:selector
	"button": "a, button, input[type=text], input[type=button], input[type=submit]",
	"controlgroupLabel": ".ui-controlgroup-label",
	"checkboxradio": "input[type='checkbox'], input[type='radio']",
	"selectmenu": "select",
	"menu":"ul, .dropdown-items",
	"spinner": ".ui-spinner-input"
}});

//set behaviour of dropdown menus... 
$(".menu").menu().css("position","absolute", "width", "200px").hide();

//cleanup any open dropdown menus
$(".menu").on('mouseleave',function(){$(".menu").hide();});

//clear dropdown autohide (DDAH)
$(".menu").on('mouseenter',function(){clearTimeout(document.DDAH);});


initMenus("file edit draw help", "file-menu edit-menu draw-menu help-menu");

// Start the CAD app
CAD.activate({canvas:document.getElementById("cad-canvas")});

}); //end of document ready
</script>
</head>


<body>
<div id="board" class="container-fluid">
<form 
id="navbar" 
class="controlgroup ui-widget-header"  
onSubmit="return inputHandler(event)">
	<button>CADbah</button>
	<button id="file">File</button>
	<button id="edit">Edit</button>
	<button id="draw">Draw</button>	
	<button id="help">Help</button>	

	<ul id="file-menu" class="menu">
		<li onclick="CAD.cmd('new')"><div>New</div></li>
		<li onclick="dxf$.dialog('open')"><div>Open</div></li>
		<li onclick="CAD.cmd('save')"><div>Save</div></li>
		<li onclick="CAD.cmd('saveas')"><div>Save as</div></li>
		
		<li>--</li>
		<li onclick="CAD.cmd('admin')"><div>Admin</div></li>
		<li>--</li>
		<li onclick="CAD.cmd('exit')"><div>Exit</div></li>
	</ul>

	<ul id="edit-menu" class="menu">
		<li>--</li>
		<li onclick="CAD.cmd('CUT')"><div>Cut</div></li>
		<li onclick="CAD.cmd('COPY')"><div>Copy</div></li>
		<li onclick="CAD.cmd('PASTE')"><div>Paste</div></li>
		<li onclick="CAD.cmd('DELETE')"><div>Delete</div></li>
		<li onclick="CAD.cmd('SELECT')"><div>Select</div></li>
		<li>--</li>
		<li onclick="CAD.cmd('BLOCKDEF')"><div>Block-Def</div></li>
		<li onclick="CAD.cmd('BLOCKADD')"><div>Block-Add</div></li>
		<li onclick="CAD.cmd('BLOCKEDIT')"><div>Block-Edit</div></li>
		<li>--</li>
		<li onclick="CAD.cmd('MOVE')"><div>Move</div></li>
		<li onclick="CAD.cmd('MIRROR')"><div>Mirror</div></li>
		<li onclick="CAD.cmd('ROTATE')"><div>Rotate</div></li>
		<li onclick="CAD.cmd('SCALE')"><div>Scale</div></li>
		<li>--</li>
		<li onclick="CAD.cmd('PROPERTIES')"><div>Properties</div></li>
		</ul>

	<ul id="draw-menu" class="menu">
		<li onclick="CAD.cmd('ARC')"><div>Arc</div></li>
		<li onclick="CAD.cmd('BLOCKINS')"><div>Block-Ins</div></li>
		<li onclick="CAD.cmd('CIRCLE')"><div>Circle</div></li>
		<li onclick="CAD.cmd('IMAGE')"><div>Image</div></li>		
		<li onclick="CAD.cmd('LINE')"><div>Line</div></li>
		<li onclick="CAD.cmd('POLYLINE')"><div>Polyline</div></li>
		<li onclick="CAD.cmd('RECTANGLE')"><div>Rectangle</div></li>
		<li onclick="CAD.cmd('TEXT')"><div>Text</div></li>
	</ul>

	<ul id="help-menu" class="menu">
		<li onclick="CAD.cmd('about')"><div>About</div></li>
		<li><div>User</div>
			<ul>
			<li onclick="CAD.cmd('overview')"><div>Overview</div></li>
			<li onclick="CAD.cmd('commandlist')"><div>Command list</div></li>
			<li onclick="CAD.cmd('documentation')"><div>Documentation</div></li>
			</ul>
		</li>
		<li><div>Develper</div>
			<ul>
			<li><div>Dev Overview</div></li>
			<li><div>System events</div></li>
			</ul>		
		</li>
		<li><div>MIT License</div></li>
	</ul>
	<input id="myInput" type="text" placeholder="command" class="drop-zone">
	<input type="submit" value="Ok">
</form>
<div id="cad-view" ><canvas id="cad-canvas"></canvas></div>
</div><!-- board -->


<div id="DXF-OPEN" class="form-group" style="display:none">
	<label for="exampleInputFile">Choose a DXF file...</label>
	<input type="file" accept=".dxf" id="dxf" name="file">
	<div class="progress progress-striped" style="width: 300px;">
		<div id="file-progress-bar" class="progress-bar progress-bar-success" role="progressbar" style="width: 0">
		</div>
	</div>
	<div id="file-description" class="help-block"></div>
</div>


</body>



</html>